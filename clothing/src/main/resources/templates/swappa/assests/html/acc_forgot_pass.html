<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quên mật khẩu</title>
    <link rel="shortcut icon" href="/assests/srcPic/x.png" type="image/x-icon">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <link rel="stylesheet" href="/bootstrap-5.3.2-dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="/assests/css/style.css">
</head>
<body>
    <div th:replace="~{swappa/assests/html/layout/_layout::header}"></div>
    <div>
        <div
            style="background-image: url('/assests/images/1323882.png'); background-size: cover; background-position: center; width: 100%; height: 100vh; display: flex; justify-content: center; align-items: center;">
            <!-- body -->
            <main class="container">
                <!-- Section: Design Block -->
                <div class="row">

                    <section class="text-center d-flex justify-content-center align-items-center">

                        <div class="card shadow-5-strong w-50 " style="
                  background: hsla(0, 0%, 0%, 0.5);
                  backdrop-filter: blur(50px);
                  ">
                            <div class="card-body py-5 px-md-5 pb-2">


                                <div class="justify-content-center">
                                    <div class="">
                                        <h2 class="fw-bold text-white">FORGOT PASSWORD</h2>
                                        <div class="mb-5">
                                            <span class="text-white fw-bolder">Please enter all information below</span>
                                        </div>
                                        <form name="formForgot" class="text-white"
                                            th:action="@{/submit-forgot-password}" method="post">
                                            <!-- lỗi thì thông báo ở đay nè -->
                                            <div ng-hide="status == null" class="alert text-bg-dark"
                                                ng-class="{'text-danger invalid-input':(status !== 1), 'text-success valid-input': (status === 1)}">
                                                {{textStatus}}
                                            </div>
                                            <!-- Email input -->
                                            <div class="form-outline mb-4">
                                                <input autofocus type="username" id="username" name="username"
                                                    class="text-bg-dark form-control" placeholder="User Name"
                                                    ng-blur="checkUsernameValidity()" required
                                                    ng-class="{'invalid-input border-0': isInvalidUserName()}"
                                                    ng-model="username" />
                                                <div class="mt-1 text-danger fs-14 text-start"
                                                    ng-show="isInvalidUserName()">
                                                    <i class="fa-solid fa-circle-info"></i> Invalid User name. Example:
                                                    Nguyễn Văn a
                                                </div>
                                            </div>

                                            <div class="form-outline mb-4">
                                                <input autofocus type="email" id="email" name="email"
                                                    class="text-bg-dark form-control" placeholder="Email address"
                                                    ng-blur="emailBlurred = true" required
                                                    ng-class="{'invalid-input border-0':isInvalidEmail()}"
                                                    ng-model="email" />
                                                <div class="mt-1 text-danger fs-14 text-start"
                                                    ng-show="isInvalidEmail()">
                                                    <i class="fa-solid fa-circle-info"></i> Invalid email. Example:
                                                    example@gmail.com
                                                </div>
                                            </div>
                                            <div class="form-outline mb-4">
                                                <div class="alert alert-danger" style="display: none;" id="errorMess"
                                                    role="alert">
                                                </div>
                                            </div>


                                            <!-- Submit button -->
                                            <button type="submit" id="signupBtn"
                                                class="btn btn-success btn-block px-5 mb-4 rounded-5"
                                                ng-disabled="!validateInputs()" onclick="callByUsernameAndEmail()">
                                                Confirm
                                            </button>

                                            <!-- Sumit register -->
                                            <!-- <a href="#!/account/register" class="btn btn-success btn-block px-5 mb-4 rounded-5 ms-3">
                                            Register
                                        </a> -->

                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>
                    <hr class="d-lg-none mb-4 d-sm-block">
                </div>
                <!-- Section: Design Block -->
            </main>

        </div>
    </div>
    <!-- footer -->
    <footer th:replace="~{swappa/assests/html/layout/_layout::footer}"></footer>
    <script src="/bootstrap-5.3.2-dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://kit.fontawesome.com/c22bed0de0.js" crossorigin="anonymous"></script>
    <script src="/assests/js/app_admin.js"></script>
    <script src="/assests/js/script.js"></script>
    <script>

        function callByUsernameAndEmail() {
            var $scope = angular.element(document.getElementById('email')).scope();
            var username = $('#username').val();
            var email = $('#email').val();
            $.ajax({
                url: '/getAccountByUsernameAndEmail?username=' + username + '&email=' + email,
                type: 'GET',
                success: function (data) {
                    var mess = $('#errorMess');
                    if (!data) {
                        // Nếu không tìm thấy tài khoản, hiển thị thông báo lỗi
                        mess.text('Account does not exist !!!');
                        mess.show();
                    } else {
                        // Nếu tài khoản tồn tại, gọi hàm showAlert() trong phạm vi của controller
                        $scope.showAlert();
                        mess.hide();
                        // $('#signupBtn').attr('type', 'submit'); // Thay đổi loại của button thành "submit"
                    }
                },
                error: function (xhr, status, error) {
                    console.log(error);
                }
            });
        }
    </script>
</body>


</html>