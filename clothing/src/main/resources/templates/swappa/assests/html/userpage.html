<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Page</title>
    <link rel="stylesheet" href="/bootstrap-5.3.2-dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="/assests/css/style.css">
    <link rel="shortcut icon" href="/assests/srcPic/x.png" type="image/x-icon">
    <style>
        #fileInput {
            display: none;
        }

        .custom-file-label {
            cursor: pointer;
            padding: 10px 20px;
            background-color: #909498;
            color: #fff;

        }

        .custom-file-label:hover {
            background-color: #9a9fa4;
        }

        #previewImage {
            width: 200px;
            height: 200px;
            object-fit: cover;
            margin-top: 20px;
        }

        #fileInput {
            border: 2px solid #909498;
            border-radius: 5px;
            box-shadow: 0px 0px 5px 0px rgba(0, 0, 0, 0.5);
        }

        #fileInput:hover {
            border-color: #9a9fa4;
        }

        #fileInput:focus {
            border-color: #9a9fa4;
            box-shadow: 0px 0px 5px 0px rgba(0, 0, 0, 0.5);
        }

        .custom-file-label {
            cursor: pointer;
            padding: 10px 20px;
            background-color: #909498;
            color: #fff;
            border: 2px solid #909498;
            border-radius: 5px;
        }

        .custom-file-label:hover {
            background-color: #9a9fa4;
        }

        #previewImage {
            width: 200px;
            height: 200px;
            object-fit: cover;
            margin-top: 20px;
            border: 2px solid #909498; /* Màu và độ dày của đường viền */
            border-radius: 5px; /* Độ cong của các góc */
        }

        #previewImage {
            width: 200px;
            height: 200px;
            object-fit: cover;
            margin-top: 20px;
            border: 2px solid #909498; /* Màu và độ dày của đường viền */
            border-radius: 5px; /* Độ cong của các góc */
            box-shadow: 0px 0px 5px 0px rgba(0, 0, 0, 0.5); /* Hiệu ứng đổ bóng */
        }

        #previewImage:hover {
            border-color: #9a9fa4; /* Thay đổi màu sắc của đường viền khi di chuột qua */
            box-shadow: 0px 0px 10px 0px rgba(0, 0, 0, 0.7); /* Hiệu ứng đổ bóng khi di chuột qua */
        }

    </style>
</head>

<body style="background-color: rgb(18,17,13);">
<!-- header -->
<div>
    <!-- mobileNav -->
    <div class="d-block d-lg-none">
        <div id="mobileNav" style="background-color: rgb(18,17,13); color: rgb(231,227,223);">
            <nav class="navbar  navbar-expand-lg navbar-dark" aria-label="Mobile Navigation">
                <div class="container-sm">

                    <button type="button" class="navbar-toggler" data-bs-toggle="offcanvas"
                            data-bs-target="#slide_menu" aria-controls="navbarSupportedContent" aria-expanded="false"
                            aria-label="Toggle navigation">
                        <i class="fa-solid fa-bars"></i>
                    </button>

                    <a href="/trangchu" class="navbar-brand" title="Swappa">
                        <img class="img-fluid"
                             src="https://static.swappa.com/static/images/logos/swappa_wordmark_ffffff_drop_e4611b.svg"
                             alt="Swappa Logo">
                    </a>

                    <button type="button" class="navbar-toggler" data-bs-toggle="offcanvas"
                            data-bs-target="#slide_search" aria-controls="navbarSupportedContent" aria-expanded="false"
                            aria-label="Search">
                        <i class="fa-solid fa-search" aria-hidden="true"></i>
                    </button>
                </div>
            </nav>
        </div>

    </div>
    <!-- mainNav -->
    <div class="d-none d-lg-block">
        <!-- first-nav -->
        <div class="stNav" style="background-color: rgb(18,17,13); color: rgb(231,227,223);">
            <nav class="navbar navbar-expand-lg  navbar-dark pb-0">
                <div class="container d-block">
                    <div class="d-flex gap-3">
                        <ul class="navbar-nav" role="presentation">
                            <li class="nav-item">
                                <a class="navbar-brand d-block text-center pt-2" href="/trangchu">
                                    <img class="img-fluid"
                                         src="https://static.swappa.com/static/images/logos/swappa_wordmark_ffffff_drop_e4611b.svg"
                                         width="167px" height="35px" alt="Bootstrap">
                                </a>
                            </li>
                        </ul>
                        <div class="flex-grow-1">
                            <form action="" class="d-flex align-items-center position-relative h-100">
                                <!-- {{keyword}} -->
                                <!-- <a ng-href="#!/searchResult" class="d-flex align-items-center position-relative h-100"> -->
                                <input type="search" class="form-control rounded-0" id="navbar_search_input"
                                       name="q" ng-model="keyword" placeholder="Find a good deal" autocomplete="off">
                                <!-- </a> -->
                            </form>
                        </div>
                        <ul class="navbar-nav" role="presentation">
                            <li class="d-flex align-items-center justify-content-center">
                                <div class="">
                                    <a href="/userprofile">
                                        <i class="fs-4 fa-solid fa-circle-user text-white" aria-hidden="true"></i>
                                    </a>
                                </div>
                            </li>
                            <li class="ms-3 d-flex align-items-center justify-content-center">
                                <a href="/giohang" class="border border-0 position-relative"
                                   style="background-color: rgb(18,17,13) !important;">
                                    <i class="fa-solid fa-fw fa-shopping-cart" style="color: white;"
                                       aria-hidden="true"></i>
                                    <span
                                            class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
                                            1
                                        </span>
                                </a>
                            </li>
                        </ul>
                    </div>
                    <div class="d-flex justify-content-around pb-1" id="userListCategory">
                        <!-- api -->
                    </div>
                </div>
            </nav>
        </div>
        <!-- second-nav -->
    </div>
</div>

<!-- main -->

<div class="container-fluid  bg-body-secondary" style="height: 800px;">
    <div class="row">
        <div class="col-xl-3 col-lg-12 mt-4">
            <div class="card">
                <div class="card-header bg-black text-center">
                    <a class="text-white bg-gradient-primary" href="../pages/tables.html">
                        <h5 class="m-0"><strong>USER PROFILE</strong></h5>
                    </a>
                </div>
                <div class="card-body pt-2">
                    <div class="align-items-start">
                        <div class="nav flex-column nav-pills me-3" id="v-pills-tab" role="tablist"
                             aria-orientation="vertical">
                            <button class="nav-link mt-1 text-black active" id="v-pills-home-tab"
                                    data-bs-toggle="pill" data-bs-target="#v-pills-home" type="button" role="tab"
                                    aria-controls="v-pills-home" aria-selected="true">My profile
                            </button>
                            <button class="nav-link mt-1 text-black" id="v-pills-home-status"
                                    data-bs-toggle="pill" data-bs-target="#v-pills-status" type="button" role="tab"
                                    aria-controls="v-pills-status" aria-selected="false">Order status
                            </button>
                            <button class="nav-link mt-1 text-black" id="v-pills-home-AllVoucher"
                                    data-bs-toggle="pill" data-bs-target="#v-pills-AllVoucher" type="button" role="tab"
                                    aria-controls="v-pills-AllVoucher" aria-selected="false">Sale
                            </button>
                            <a class="nav-link mt-1 text-black" href="">Log Out</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xl-9 col-lg-12">
            <div class="tab-content" id="v-pills-tabContent">
                <div class="tab-pane fade show active" id="v-pills-home" role="tabpanel"
                     aria-labelledby="v-pills-home-tab" tabindex="0">
                    <div class="card my-4">
                        <div class="card-body px-0 mx-3 pb-2">
                            <div class="table-responsive p-0" id="tableUserContainer">
                                <div class="header mt-3">
                                    <ul class="list-group list-group-flush">
                                        <li class="list-group-item bg-body-secondary">
                                            <h3>My profile</h3>
                                            <span>Manage profile information for account security</span>
                                        </li>
                                        <li class="list-group-item bg-body-secondary"></li>
                                    </ul>
                                </div>
                                <div class="row" th:object="${userM}">
                                    <div class="col-8">
                                        <div class="container">
                                            <div class="mb-3 row">
                                                <label for="staticName"
                                                       class="col-xl-2 col-lg-12 col-form-label">UserName</label>
                                                <div class="col-xl-10 col-lg-12">
                                                    <input type="text" readonly class="form-control-plaintext"
                                                           id="staticName" th:value="*{username}" disabled>
                                                </div>
                                            </div>
                                            <div class="mb-3 row">
                                                <label for="inputName"
                                                       class="col-xl-2 col-lg-12 col-form-label">Name</label>
                                                <div class="col-xl-10 col-lg-12">
                                                    <input type="name" class="form-control" id="inputName"
                                                           th:value="*{fullname}">
                                                </div>
                                            </div>
                                            <div class="mb-3 row">
                                                <label for="staticEmail"
                                                       class="col-xl-2 col-lg-12 col-form-label">Email</label>
                                                <div class="col-xl-10 col-lg-12">
                                                    <input type="mail" class="form-control" id="staticEmail"
                                                           th:value="*{email}" disabled>
                                                </div>
                                            </div>
                                            <div class="mb-3 row">
                                                <label for="staticPhone"
                                                       class="col-xl-2 col-lg-12 col-form-label">Phone</label>
                                                <div class="col-xl-10 col-lg-12">
                                                    <input type="number" class="form-control" id="staticPhone"
                                                           th:value="*{sdt}" pattern="[0-9]{10}"
                                                           title="Phone number must have 10 digits">
                                                    <span id="phoneError" class="text-danger"></span>
                                                </div>

                                            </div>
                                            <div class="mb-3 row alert alert-success" id="updateSuccess"></div>
                                            <div class="mb-3 row my-3 alert alert-danger" id="updateError"></div>
                                        </div>
                                    </div>
                                    <div class="col-4 text-center">
                                        <div class="d-flex justify-content-center">
                                            <img th:src="@{'/assests/imagesUser/' + ${userM.avatar}}"
                                                 class="avatar me-3 border-radius-lg"
                                                 id="previewImage" alt="Ảnh đã chọn">
                                        </div>

                                        <div class="text-center my-3" style="margin-right: 10px;">
                                            <input type="file" class="form-control" id="fileInput" accept="image/*">
                                            <label class="custom-file-label" for="fileInput">Select photos from
                                                local</label>
                                        </div>

                                    </div>

                                    <button type="button" id="submitBtn" class=" col-5 btn btn-secondary ms-5 mb-5">
                                        Submit
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="tab-pane" id="v-pills-status" role="tabpanel"
                     aria-labelledby="v-pills-home-status" tabindex="0">
                    <div class="card my-4">
                        <div class="card-body px-0 mx-3 pb-2">
                            <div class="table-responsive p-0" id="TableStatusUser">
                                <!-- Bắt đầu trạng thái đơn hàng-->
                                <div class="header mt-3">
                                    <ul class="list-group list-group-flush">
                                        <li class="list-group-item bg-body-secondary">
                                            <h3>Order status</h3>
                                            <span>Manage customer orders</span>
                                        </li>
                                        <li class="list-group-item bg-body-secondary"></li>
                                    </ul>
                                </div>

                                <table class="table table-bordered table-hover text-center">
                                    <thead class="table-dark">
                                    <tr>
                                        <th>Mã đơn đặt hàng</th>
                                        <th>Khách hàng</th>
                                        <th>Ngày lập</th>
                                        <th>Phone</th>
                                        <th>Nơi giao</th>
                                        <th>Hình thức thanh toán </th>
                                        <th>Tổng thành tiền</th>
                                        <th>Trạng thái đơn hàng</th>
                                        <th></th>
                                    </tr>
                                    </thead>
                                    <tbody>

                                    </tbody>
                                </table>

                                <!-- Kết thúc trạng thái đơn hàng-->
                            </div>
                        </div>
                    </div>
                </div>
                <div class="tab-pane" id="v-pills-AllVoucher" role="tabpanel"
                     aria-labelledby="v-pills-home-status" tabindex="0">
                    <div class="card my-4">

                        <div class="card-body px-0 mx-3 pb-2">

                            <!--viết body vào đây Cao Trọng Lễ-->
                            <div class="table-responsive p-0" id="TableAllVoucher">
                                <div class="header my-3">
                                    <ul class="list-group list-group-flush">
                                        <li class="list-group-item bg-body-secondary">
                                            <h3>Sale</h3>
<!--                                            <span>Manage profile information for account security</span>-->
                                        </li>
                                        <li class="list-group-item bg-body-secondary"></li>
                                    </ul>
                                </div>
                                <div class="container">
                                    <div class="row">
                                        <div id="voucherList" class="row"></div>
<!--                                       <div class="col-xl-6 col-lg-12">-->
<!--                                           <div class="card mb-3">-->
<!--                                               <div class="row g-0">-->
<!--                                                   <div class="col-md-4">-->
<!--                                                       <img src="/assests/images/logoVoucher.jpg" class="img-fluid rounded-start" alt="...">-->
<!--                                                   </div>-->
<!--                                                   <div class="col-md-8">-->
<!--                                                       <div class="card-body py-0 mt-3">-->
<!--                                                           <h5 class="card-title">Card title</h5>-->
<!--                                                           <p class="card-text">This is a wider card with supporting text below as a natural lead-in to additional content. This content is a little bit longer.</p>-->
<!--                                                           <p class="card-text"><small class="text-body-secondary">Last updated 3 mins ago</small></p>-->
<!--                                                       </div>-->
<!--                                                   </div>-->
<!--                                               </div>-->
<!--                                           </div>-->
<!--                                       </div>-->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- footer -->
<footer style="background-color: rgb(18,17,13); color: rgb(231,227,223);">
    <div class="container pt-2 pb-2">
        <div class="row row-cols-2 row-cols-md-3 row-cols-lg-6">

        </div>
        <div class="row row-cols-1 row-cols-md-3">
            <div class="col d-flex justify-content-center align-items-center">
                <div class=" text-white">
                    <a href="https://www.facebook.com/profile.php?id=100031628760243" style="color: white">
                        <i class="fa-brands fa-square-facebook fs-1"></i>
                    </a>
                    <a href="https://www.facebook.com/profile.php?id=100031628760243" style="color: white">
                        <i class="fa-brands fa-square-instagram fs-1"></i>
                    </a>
                    <a href="https://www.facebook.com/profile.php?id=100031628760243" style="color: white">
                        <i class="fa-brands fa-youtube fs-1"></i>
                    </a>
                    <a href="https://www.facebook.com/profile.php?id=100031628760243" style="color: white">
                        <i class="fa-brands fa-linkedin fs-1"></i>
                    </a>
                    <a href="https://www.facebook.com/profile.php?id=100031628760243" style="color: white">
                        <i class="fa-brands fa-square-reddit fs-1"></i>
                    </a>
                </div>
            </div>
            <div class="col text-center ">
                <a href="./index.html"><img
                        src="https://static.swappa.com/static/images/logos/swappa_wordmark_ffffff.svg"
                        class="img-fluid" alt=""></a>
            </div>
            <div class="col text-center text-white d-flex justify-content-center align-items-center">
                <p class="fs-5">Copyright © 2023-2024 -M2M-</p>
            </div>
        </div>
    </div>
</footer>

</body>
<script>
    var path;
    var nameImg;
    document.getElementById('fileInput').addEventListener('change', function () {
        var file = this.files[0];
        nameImg = file.name;
        if (file) {
            var reader = new FileReader();
            reader.onload = function (event) {
                path = event.target.result;
                document.getElementById('previewImage').setAttribute('src', event.target.result);
                document.getElementById('previewImage').style.display = 'block';
            }
            reader.readAsDataURL(file);
        }
    });
</script>
<script src="/node_modules/angular/angular.min.js"></script>
<script src="/bootstrap-5.3.2-dist/js/bootstrap.bundle.min.js"></script>
<script src="https://kit.fontawesome.com/c22bed0de0.js" crossorigin="anonymous"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

<!--<script th:src="@{/assests/js/userpage.js}"></script>-->
<script>
    $(document).ready(function () {
        // Sử dụng Ajax để gọi API và lấy danh sách voucher
        $.ajax({
            url: '/api-public/vouchers/getVouchersByEmail', // URL của API endpoint
            type: 'GET',
            success: function (response) {
                // Xử lý dữ liệu khi API trả về thành công
                var vouchers = response;
                var voucherListHTML = '';

                // Duyệt qua danh sách voucher và tạo HTML tương ứng
                vouchers.forEach(function (voucher) {
                    voucherListHTML += `
                <div class="col-xl-6 col-lg-12">
                    <div class="card mb-3">
                        <div class="row g-0">
                            <div class="col-md-4">
                                <img src="/assests/images/logoVoucher.jpg" class="img-fluid rounded-start" alt="...">
                            </div>
                            <div class="col-md-8">
                                <div class="card-body py-0 mt-3">
                                    <h5 class="card-title">${voucher.voucherName}</h5>
                                    <p class="card-text">Giảm giá: ${voucher.reduce}</p>
                                    <p class="card-text">Ngày bắt đầu: ${voucher.startDay}</p>
                                    <p class="card-text">Ngày kết thúc: ${voucher.endDay}</p>
                                    <!-- Thêm các thông tin khác cần hiển thị -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
                });

                // Đưa HTML vào div chứa danh sách voucher
                $('#voucherList').html(voucherListHTML);
            },
            error: function (xhr, status, error) {
                // Xử lý khi gọi API gặp lỗi
                console.error('Error calling API:', error);
            }
        });
    });
</script>



<script>

    $(document).ready(function () {
        $('#updateSuccess, #updateError').hide();

        function updateUser() {
            var username = $('#staticName').val();
            var fullname = $('#inputName').val();
            var email = $('#staticEmail').val();
            var sdt = $('#staticPhone').val();
            if (sdt.length !== 10) {
                $('#phoneError').text("*Phone number must have 10 digits");
                return;
            } else {
                $('#phoneError').text("");
            }
            var avatar = null;
            if (nameImg && path) {
                avatar = nameImg + "," + path; // Nếu đã chọn ảnh mới, sử dụng giá trị mới cho avatar
            }
            console.log(avatar);
            let userData = {
                username: username,
                email: email,
                fullname: fullname,
                sdt: sdt,
                avatar: avatar
            };
            $.ajax({
                url: '/api-public/users/updateUserInfo',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(userData),
                success: function (response) {
                    console.log(response === 1 ? 'Cập nhật thành công' : 'Cập nhật thất bại');
                    if (response === 1) {
                        $('#updateError').hide();
                        $('#updateSuccess').text('Update successful').show();
                    } else {
                        $('#updateSuccess').hide();
                        $('#updateError').text('Update failed').show();
                    }
                },
                error: function (xhr, status, error) {
                    console.error("Đã xảy ra lỗi khi gọi API: " + error);
                }
            });
        }

        $('#submitBtn').click(function () {
            updateUser();
        });
    });
</script>
<script>
    $(document).ready(function() {
        // Gọi API để lấy danh sách đơn hàng dựa trên email của người dùng
        $.ajax({
            url: '/api-product/orders',
            type: 'GET',
            success: function(data) {
                // Hiển thị dữ liệu trong bảng
                data.forEach(function(order) {
                    var orderDateFormatted = new Date(order.orderDate);
                    var formattedDate = `${orderDateFormatted.getDate()}/${orderDateFormatted.getMonth() + 1}/${orderDateFormatted.getFullYear()}`;
                    $('#TableStatusUser tbody').append(`
                    <tr class="align-middle">
                        <td class="text-center">${order.orderId}</td>
                        <td class="text-center">${order.username}</td>
                        <td class="text-center">${formattedDate}</td>
                        <td class="text-center">${order.phoneNumber}</td>
                        <td class="text-center">${order.deliveryAddress}</td>
                        <td class="badge text-bg-secondary text-center" style="vertical-align: middle; text-align: center;">${order.paymentMethod}</td>
                        <td class="text-center">$${order.totalAmount}</td>
                        <td class="${order.orderStatus == 'Confirmed successfully' ? 'badge text-bg-success' : 'badge text-bg-warning'} text-center">${order.orderStatus}</td>
                        <td class="text-center"><button class="btn btn-success" ${
                        (() => {
                            switch (true) {
                                case ((order.paymentMethod === 'Cod' && (order.orderStatus ==='Confirmed successfully' || order.orderStatus ==='Wait for confirmation'))):
                                    return 'disabled';
                                case ((order.paymentMethod === 'PayPal' && order.orderStatus ==='Wait for confirmation')):
                                    return 'disabled';
                                case ((order.paymentMethod === 'PayPal' && order.orderStatus ==='Confirmed successfully')):
                                    return "";
                            }
                        })()
                        }
                        onclick="payWithPaypal(${order.totalAmount})">Pay with paypal</button></td>
                    </tr>
                `);
                });
            },
            error: function(jqXHR, textStatus, errorThrown) {
                console.error('Error:', errorThrown);
            }
        });
    });
    const payWithPaypal = async (amount, orderId) => {
        let description = 'testing';
        let intent = 'sale';
        let method = 'paypal';
        let currency = 'USD';

        try {
            const response = await $.ajax({
                type: 'POST',
                url: 'http://localhost:8083/payment/paypal/create-payment',
                contentType: 'application/json',
                data: JSON.stringify({
                    description: description,
                    intent: intent,
                    method: method,
                    currency: currency,
                    totalAmount: amount,
                    orderId: orderId
                }),
                success: (data) => {
                    window.location.href = data;
                },
                error: (error) => {
                    console.log('>>error:', error);
                }
            });
        } catch (error) {
            console.error('>>error:', error);
        }
    }

</script>





</html>